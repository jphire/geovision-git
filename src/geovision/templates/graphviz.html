{% extends "sitebase.html" %}

{% block additional_head %}

<!-- JIT Library File -->
<script language="javascript" type="text/javascript" src="{{ STATIC_URL }}JIT.js"></script>


<script language="javascript" type="text/javascript">
	var staticurl = "{{ STATIC_URL }}";
</script>

<link rel="stylesheet" href="{{ STATIC_URL }}base.css" type="text/css"/>
<link type="text/css" href="{{ STATIC_URL }}ui-lightness/jquery-ui.css" rel="stylesheet" />	

<script language="javascript" type="text/javascript" src="{{ STATIC_URL}}jquery.contextmenu.r2.js"></script>

<!-- Example File -->
<script language="javascript" type="text/javascript" src="{{ STATIC_URL }}graphviz.js"></script>

<!-- JSON File -->
{% if json_base_url %}
<script language="javascript" type="text/javascript">
	var json_base_url = "{{ json_base_url|safe }}";
 	$.getJSON(json_base_url + "&{{ json_query_url_part|safe }}", function(data) { initGraph(data); });
</script>
{% endif %}
<!-- jQuery-UI, for autocomplete -->
<script language="javascript" type="text/javascript" src="{{ STATIC_URL }}jquery-ui.js"></script>

{% endblock %}

{% block additional_title %}- graph {% endblock %}
<!--[if IE]><script language="javascript" type="text/javascript" src="../../Extras/excanvas.js"></script><![endif]-->
{% block sidenavi_content %}

{% if error_message or not json_base_url %}
	<script language="javascript" type="text/javascript">openSearch($('#graphnavi'));</script>
	<div class="error" id="error">{{ error_message }}</div>
{% else %}
	<!--<div class="error" id="error"></div>-->
{% endif %}

<a style="float:left; border: 2px white solid; background-color: #F2F2F2; margin-left: 10px;" href="logging_out">Logout</a><br/><br/>
<form id="graphrefreshform" action="graphrefresh" method="post">{% csrf_token %} <!--protects from cross site request forgery-->
    <p>Input only one of the three following:</p>
    <label>Enzyme</label>
    <input size="10" type="text" name="enzyme" id="ec" value="{{ enzyme }}"/><br/><br/>
	{% if enzyme_list %}
	Multiple enzymes matched, pick one:
	{% for e in enzyme_list %}
	<p class="submitForm" id='{{ e.enzyme }}'>{{ e.enzyme_name }} ({{ e.enzyme }})</p>
	{% endfor %}
	{% endif %}
    <label>Read id</label>
    <input size="10" type="text" name="read" value="{{ read }}"/><br/><br/>
    <label>DB entry id</label>
    <input size="10" type="text" name="dbentry" value="{{ dbentry }}"/><br/><br/>
    <label>Bitscore</label>
    <input size="10" type="text" name="bitscore" value="{{ bitscore }}"/><br/><br/>
    <label>E-value</label>
    <input size="10" type="text" name="e-value" value="{{ evalue }}"/><br/><br/>
    <label>Depth</label>
    <input size="10" type="text" name="depth" value="{{ depth }}"/><br/><br/>
    <label>Hits</label>
    <input size="10" type="text" name="hits" value="{{ hits }}" /><br/><br/>
    <input id="graphrefresh" type="submit" value="Refresh page" size="10"/><br/>
</form>

<script language="javascript" type="text/javascript">
	$(function()
	{
		$( "#ec" ).autocomplete(
		{
			source: '/autocomplete',
			appendTo: '#navicontainer',
			position: { my : "center top", at: "center bottom"}
		});
	});
</script>

{% endblock %}
{% block content %}
<body onload="init();">
    <div class="contextMenu" id="nodeMenu">
        <ul> 
             <li id="close">Close menu</li>
             <li id="n_center">Center Node</li>
             <li id="e_align">Show Alignment</li>
             <li id="n_tag">Tag/Untag Node</li>
             <li id="n_tagparents">Tag Parents</li>
             <li id="n_tagsubnodes">Tag Subnodes</li>
             <li id="n_tagsubgraph">Tag Subgraph</li>
             <li id="n_untagsubgraph">Untag Subgraph</li>
             <li id="n_tagpath">Tag Path</li>
			 <li id="n_en_names">Show info</li>
			 <li id="n_en_brendalink">Brenda</li>
			 <li id="n_en_kegglink">KEGG</li>
			 <li id="n_db_uni_link">Uniprot</li>
			 <li id="n_db_frn_link">Frnadb</li>
			 <li id="n_db_frn_silva">Silva</li>
        </ul>
    </div>
    <div id="loader"><img src="../static/images/loader.gif" alt="Loading..."/></div>

	<div id="container">		
		<div id="graphcontainer">
			<div id="center-container">
				<span id="load"></span>
				<div id="infovis"></div>
			</div>

			<div id="right-container">
				<div id="inner-details"></div>
				<span id="helplink">Help</span>
				<div id="help">
					Right click on an edge to show alignment of read sequence and database sequence (upper is read). The data opens under the graph and only one alignment can be visible at the same time.
				<br/>
				</div>
				<br/>
				<br/>
				<div id="coloring">
					<form id="colorform">
						<input type="radio" name="colortype" id="colortypeDynamic" value="dynamic" checked>Dynamic</input><br/>
						<input type="radio" name="colortype" id="colortypeCustom" value="custom">Custom: </input>
						<input type="text" id="colorMin" size="4" disabled/>-<input type="text" id="colorMax" size="4" disabled/><br/>
						<input type="submit" id="colorizeSubmit" value="Colorize"/>
						<span id="colorErrorMsg" class="error"></span>
					</form>
				</div>
				<br/>
				<span id="filterlink">Filter graph</span>
				<div id="filter">
					<form id="filterform" action="" method="post">
						<span id="filtererror"></span>
						<br/><p>Filter now visible graph with bitscore:</p>
						<input size="10" type="text" name="bitscorefilter" id="bitscorefilter" value=""/><br/>
						<input id="filterbutton" type="submit" value="Filter" size="10"/><br/>
					</form>
				</div>
				<div id="names"></div>

			</div>

			<div id="log"></div>
		</div>
		<div id="alignment"></div>
	</div>
</body>
{% endblock %}


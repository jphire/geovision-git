{% extends "sitebase.html" %}

{% block additional_head %}

<!-- JIT Library File -->
<script language="javascript" type="text/javascript" src="{{ STATIC_URL }}JIT.js"></script>

<link rel="stylesheet" href="{{ STATIC_URL }}base.css" type="text/css"/>
<link type="text/css" href="{{ STATIC_URL }}ui-lightness/jquery-ui.css" rel="stylesheet" />	

<script language="javascript" type="text/javascript" src="{{ STATIC_URL}}jquery.contextmenu.r2.js"></script>

<!-- RGraph configuration settings -->
<script language="javascript" type="text/javascript" src="{{ STATIC_URL }}js/bitscore.js"></script>
<script language="javascript" type="text/javascript" src="{{ STATIC_URL }}js/config.js"></script>
<script language="javascript" type="text/javascript" src="{{ STATIC_URL }}js/contextmenu.js"></script>
<script language="javascript" type="text/javascript" src="{{ STATIC_URL }}js/events.js"></script>
<script language="javascript" type="text/javascript" src="{{ STATIC_URL }}js/labels.js"></script>
<script language="javascript" type="text/javascript" src="{{ STATIC_URL }}js/navigation.js"></script>
<script language="javascript" type="text/javascript" src="{{ STATIC_URL }}js/moreinfo.js"></script>
<script language="javascript" type="text/javascript" src="{{ STATIC_URL }}js/styles.js"></script>
<script language="javascript" type="text/javascript" src="{{ STATIC_URL }}js/tips.js"></script>
<script language="javascript" type="text/javascript" src="{{ STATIC_URL }}graphviz.js"></script>

<script language="javascript" type="text/javascript">
$(function() {
{% if json_base_url %}
	json_base_url = "{{ json_base_url|safe }}";
 	$.getJSON(json_base_url + "&{{ json_query_url_part|safe }}", function(data) { initGraph(data); });
{% else %}
	initGraph(null);
{% endif %}
var settings = "{{user_settings}}";
});
</script>
<!-- jQuery-UI, for autocomplete -->
<script language="javascript" type="text/javascript" src="{{ STATIC_URL }}jquery-ui.js"></script>

{% endblock %}

{% block additional_title %}- graph {% endblock %}
<!--[if IE]><script language="javascript" type="text/javascript" src="../../Extras/excanvas.js"></script><![endif]-->
{% block sidenavi_content %}

{% if error_message or not json_base_url %}
	<script language="javascript" type="text/javascript">openSearch($('#graphnavi'));</script>
	<div class="error" id="error">{{ error_message }}</div>
{% else %}
	<!--<div class="error" id="error"></div>-->
{% endif %}

<a style="float:left; border: 2px white solid; background-color: #F2F2F2; margin-left: 10px;" href="logging_out">Logout</a><br/><br/>
<form id="graphrefreshform" action="graphrefresh" method="post">{% csrf_token %} <!--protects from cross site request forgery-->
    <p>Input only one of the three following:</p>
    <label>Enzyme</label>
    <input size="10" type="text" name="enzyme" id="ec" value="{{ enzyme }}"/><br/><br/>
	{% if enzyme_list %}
	Multiple enzymes matched, pick one:
	{% for e in enzyme_list %}
	<p class="submitForm" id='{{ e.enzyme }}'>{{ e.enzyme_name }} ({{ e.enzyme }})</p>
	{% endfor %}
	{% endif %}
    <label>Read id</label>
    <input size="10" type="text" name="read" value="{{ read }}"/><br/><br/>
    <label>DB entry id</label>
    <input size="10" type="text" name="dbentry" value="{{ dbentry }}"/><br/><br/>
    <label>Bitscore</label>
    <input size="10" type="text" name="bitscore" value="{{ bitscore }}"/><br/><br/>
    <label>E-value</label>
    <input size="10" type="text" name="e-value" value="{{ evalue }}"/><br/><br/>
    <label>Depth</label>
    <input size="10" type="text" name="depth" value="{{ depth }}"/><br/><br/>
    <label>Hits</label>
    <input size="10" type="text" name="hits" value="{{ hits }}" /><br/><br/>
    <input id="graphrefresh" type="submit" value="Refresh page" size="10"/><br/>
</form>

<script language="javascript" type="text/javascript">
	$(function()
	{
		$( "#ec" ).autocomplete(
		{
			source: '/autocomplete',
			appendTo: '#navicontainer',
			position: { my : "center top", at: "center bottom"}
		});
	});
</script>

{% endblock %}
{% block content %}
<body>
    <div class="contextMenu" id="nodeMenu">
        <ul> 
             <li id="close">Close menu</li>
             <li id="n_center">Center Node</li>
             <li id="e_align">Show Alignment</li>
             <li id="n_tag">Tag/Untag Node</li>
             <li id="n_tagparents">Tag Parents</li>
             <li id="n_tagsubnodes">Tag Subnodes</li>
             <li id="n_tagsubgraph">Tag Subgraph</li>
             <li id="n_untagsubgraph">Untag Subgraph</li>
             <li id="n_tagpath">Tag Path</li>
			 <li id="n_en_names">Show info</li>
			 <li id="n_en_brendalink">Brenda</li>
			 <li id="n_en_kegglink">KEGG</li>
			 <li id="n_db_uni_link">Uniprot</li>
			 <li id="n_db_frn_link">Frnadb</li>
			 <li id="n_db_silva_link">Silva</li>
        </ul>
    </div>
    <div id="loader"><img src="../static/images/loader.gif" alt="Loading..."/></div>

	<div id="container">		
		<div id="graphcontainer">
			<div id="center-container">
				<span id="load"></span>
				<div id="infovis"></div>
			</div>

			<div id="right-container">
				<div id="inner-details"></div>
				<span id="settingslink">Your settings</span><br/>
				<div id="settings">
					{%if settingsmessage%}<span style="color:red;" id="settingmessage">{{ settingsmessage }}</span>{%endif%}
					<form id="settingsform" action="savesettings" method="post">
						<label>Canvas size:</label><br/>
						<input type="text" size="6" name="canvas_x" value=""> x <input type="text" size="6" name="canvas_y" value=""><br/>
						<label>Animations:</label><br/>
						<input type="radio" name="group1" value="animations_on"> On<br/>
						<input type="radio" name="group1" value="animations_off"> Off<br/>
						<label>Animation speed:</label><br/>
						<input size="7" type="text" name="duration" value="" />
						<label>Animation type:</label><br/>
						<select name="animationtype">
						  <option value="linear">Linear</option>
						  <option value="Quad">Quadratic</option>
						  <option value="Cubic">Cubic</option>
						  <option value="Quart">Quartetic</option>
						  <option value="Quint">Quintic</option>
						  <option value="Expo">Exponential</option>
						  <option value="Circ">Circular</option>
						  <option value="Sine">Sineousidal</option>
						  <option value="Bounce">Bounce</option>
						  <option value="Back">Back</option>
						  <option value="Elastic">Elastic</option>
						</select>
						<label>Animation subtype:<br/>
						Note: does not effect linear transitions</label>
						<select name="animationsubtype">
							<option value="easeIn">Ease in</option>
							<option value="easeOut">Ease out</option>
							<option value="easeInOut">Ease in and out</option>
						</select>
						<p><strong>Warning</strong>: changing settings refreshes the page</p>
						<input id="savesettings" name="savesettings" type="submit" value="Save your settings" size="10"/><br/>
						<input id="defaultsettings" name="defaultsettings" type="submit" value="Switch to defaults" size="10"/><br/>
					</form>
					<br/>
				</div>
				<br/>
				<span id="helplink">Help</span>
				<div id="help">
					Right click on an edge to show alignment of read sequence and database sequence (upper is read). The data opens under the graph and only one alignment can be visible at the same time.
				<br/>
				</div>
				<br/>
				<br/>
				<div id="coloring">
					<form id="colorform">
						<input type="radio" name="colortype" id="colortypeDynamic" value="dynamic" checked>Dynamic</input><br/>
						<input type="radio" name="colortype" id="colortypeCustom" value="custom">Custom: </input>
						<input type="text" id="colorMin" size="4" disabled/>-<input type="text" id="colorMax" size="4" disabled/><br/>
						<input type="submit" id="colorizeSubmit" value="Colorize"/>
						<span id="colorErrorMsg" class="error"></span>
					</form>
				</div>
				<br/>
				<span id="filtertext">Filter graph</span>
				<div id="filter">
					<form id="filterform" action="" method="post">
						<span id="filtererror"></span>
						<p>Filter now visible graph with bitscore:</p>
						<input size="10" type="text" name="bitscorefilter" id="bitscorefilter" value=""/><br/>
						<input id="filterbutton" type="submit" value="Filter" size="10"/><br/>
					</form>
				</div>
				<div id="names"></div>

			</div>

			<div id="log"></div>
		</div>
		<div id="alignment"></div>
	</div>
</body>
{% endblock %}

